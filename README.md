# üíé On-The-Go (OTG) AppSuite

**Version:** Diamond Edition v68.8  
**Architecture:** Serverless / Headless / PWA  
**Status:** Production Ready

The **OTG AppSuite** is a comprehensive, low-cost "Do-It-Yourself" safety system designed for non-profits and community groups. It transforms a standard Google Sheet into a powerful backend database for a suite of Lone Worker safety applications.

---

## üèóÔ∏è System Components

The suite consists of four distinct components:

1.  **üè≠ The Factory App:**
    * A static HTML configuration wizard.
    * Generates the custom Worker and Monitor apps based on your organization's settings.
    * Provides "Copy & Paste" setup for the Google Sheet database.

2.  **üì± The Worker App (PWA):**
    * Mobile-first Progressive Web App for field staff.
    * **Features:** Offline-first architecture, GPS tracking, Deadman timer, Panic button, Vehicle checks, and custom form reporting.

3.  **üñ•Ô∏è The Monitor App:**
    * Command & Control dashboard for HQ.
    * **Features:** Live status grid, Tactical Map View (Leaflet.js), Audio/Visual alarms, and manual incident resolution.

4.  **‚öôÔ∏è The Backend (API):**
    * Google Apps Script web app acting as the interface between the apps and the Google Sheet.
    * Handles authentication, logic, AI grammar cleaning, and email alerts.

---

## üöÄ Installation & Deployment

### Prerequisite
You need a Google Account (for the database) and a static web host (e.g., Netlify, GitHub Pages) for the apps.

### Step 1: Configuration (The Factory)
1.  Open `Factory/index.html` in your browser.
2.  Enter your Organisation Name and a strong **Secret Key**.
3.  (Optional) Enter API Keys for extended features:
    * **OpenRouteService:** For road mileage calculations.
    * **Gemini AI:** For "Smart Scribe" grammar cleanup in reports.
    * **Textbelt:** For SMS alerts on critical failures.

### Step 2: Database Setup
1.  Create a new [Google Sheet](https://sheets.new).
2.  Use the Factory App buttons to copy headers and instructions for the required tabs:
    * `Visits` (Transactional Data)
    * `Templates` (Form Configuration)
    * `Sites` (Location Assignment)
    * `Staff` (User Authentication)

### Step 3: Backend Deployment
1.  In the Google Sheet, go to **Extensions > Apps Script**.
2.  Paste the code generated by the Factory (Step 3).
3.  **Deploy:** Click `Deploy` > `New Deployment` > `Web App`.
4.  **Permissions:** Set "Execute as: Me" and "Who has access: **Anyone**".
5.  **Triggers:** Set up Time-Driven triggers for `checkOverdueVisits` (10 mins) and `archiveOldData` (Weekly).

### Step 4: Build & Host
1.  Download the `Diamond.zip` from the Factory.
2.  Upload the `WorkerApp` folder to a host (e.g., Netlify).
3.  Upload the `MonitorApp` folder to a host.
4.  Distribute URLs to staff.

---

## üìÇ Data Structure (Google Sheets)

### Tab: `Visits`
Stores all event logs.
| Col | Field | Notes |
| :--- | :--- | :--- |
| A | Timestamp | Server Time |
| C | Worker Name | Linked to Staff |
| K | **Alarm Status** | `ON SITE`, `DEPARTED`, `EMERGENCY`, `SAFE` |
| O | GPS | Lat,Lng coordinates |
| T | Visit Report Data | JSON String of form responses |
| U | Anticipated Departure | The "Deadman" timer target |

### Tab: `Staff`
Controls access and device locking.
| Col | Field | Notes |
| :--- | :--- | :--- |
| A | Name | Case-sensitive ID |
| C | Status | Set to `Inactive` to block access |
| E | **DeviceID** | Auto-filled on first login. Locked to hardware. |

### Tab: `Templates`
Defines dynamic forms.
| Syntax | Input Type | Description |
| :--- | :--- | :--- |
| `[TEXT]` | Textarea | Multi-line text input |
| `[NUMBER]` | Number | Numeric keypad input |
| `[YESNO]` | Radio | Yes/No toggle |
| `[CHECK]` | Checkbox | Simple tick box |
| `[PHOTO]` | File | Camera capture (compressed client-side) |
| `[GPS]` | Button | Captures current coords |
| `[SIGN]` | Canvas | Touch signature pad |
| `[HEADING]` | UI | Visual section separator |
| `[NOTE]` | UI | Read-only instruction text |

---

## üõ°Ô∏è Security & Authentication

### Worker App
* **Name Matching:** User must enter a name exactly matching the `Staff` sheet.
* **Device Fingerprinting:** On first sync, the device generates a UUID. This ID is written to the `Staff` sheet (Col E). All future requests must match this ID, or they are rejected.
* **Reset:** To allow a worker to change phones, an Admin must clear Col E in the spreadsheet.

### Monitor App
* **Secret Key:** The Monitor App does not use the spreadsheet `Staff` list. Instead, the operator must enter the **Organisation Secret Key** on first load.
* **Storage:** The key is stored in the browser's `localStorage`.
* **Resolution:** When resolving an emergency, the Monitor sends a special `action=resolve` command, which bypasses the Device ID check if the Secret Key is valid.

---

## ü§ñ AI Integration (Smart Scribe)
If a **Gemini API Key** is provided:
* Text fields in email reports with >20 characters are processed by AI.
* **Prompt:** "Correct grammar to NZ English".
* **Privacy:** The database (`Visits` tab) retains the raw, original text for legal/audit purposes. Only the Email Notification contains the AI-polished text.

---

## ‚ö†Ô∏è Limitations & Disclaimer

1.  **Sleep Mode (iOS):** As a Web App, GPS tracking may pause if the phone screen is off for extended periods. Staff should wake the phone occasionally.
2.  **Connectivity:** Requires an internet connection to send alerts. Data is queued offline and sent when connection is restored.
3.  **SLA:** This software runs on Google's free infrastructure. There is no Service Level Agreement (SLA) for uptime.
4.  **Target Audience:** Designed for community and low-risk environments. **Not suitable for high-voltage, forestry, or critical life-safety operations.**

---

## üìú License
**MIT License** - Free for use, modification, and distribution.
