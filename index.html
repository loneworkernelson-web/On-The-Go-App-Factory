<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OTG Factory v79.35 (Master Edition)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
    .step-section { display: none; }
    .step-section.active { display: block; animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .input-field { width: 100%; background: #1e293b; border: 2px solid #475569; padding: 1rem; border-radius: 0.75rem; color: white; font-size: 1.1rem; transition: border-color 0.2s; font-weight: 700; }
    .input-field:focus { border-color: #3b82f6; outline: none; }
    .btn { padding: 1rem 2rem; border-radius: 0.75rem; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }
    .btn-primary { background: linear-gradient(to right, #2563eb, #3b82f6); color: white; }
    .highlight-box { background: #1e293b; border: 1px solid #334155; border-radius: 1rem; padding: 1.5rem; }
    .tab-btn { flex: 1; py-4; font-weight: bold; color: #94a3b8; border-bottom: 4px solid transparent; transition: all 0.2s; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }
    .tab-btn.active { color: #60a5fa; border-color: #3b82f6; background: #1f2937; }
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
    .modal-content { background: #1e293b; padding: 2rem; border-radius: 1rem; border: 2px solid #475569; max-width: 600px; width: 90%; }
    .preset-swatch { width: 56px; height: 56px; border-radius: 12px; cursor: pointer; border: 3px solid rgba(255,255,255,0.2); transition: all 0.1s; display: flex; overflow: hidden; }
    .preset-swatch:hover { transform: scale(1.1); border-color: #3b82f6; }
    .preset-swatch.selected { outline: 4px solid #3b82f6; outline-offset: 3px; transform: scale(1.05); border-color: white; }
    .swatch-half { flex: 1; height: 100%; }
  </style>
</head>
<body class="min-h-screen py-8 px-4 relative">

  <div id="disclaimerModal" class="modal-backdrop" style="display: flex;">
      <div class="modal-content border-yellow-600">
          <h2 class="text-2xl font-extrabold text-white mb-2">‚ö†Ô∏è Safety Notice</h2>
          <div class="space-y-4 text-gray-200 text-sm mb-6 font-bold">
              <p>Tracking requires staff to keep the app active and connectivity requires internet and valid API keys.</p>
          </div>
          <div class="pt-4 border-t border-gray-700 font-bold">
              <label class="flex items-start gap-3 cursor-pointer">
                  <input type="checkbox" id="chkAccept" class="mt-1 w-5 h-5" onchange="toggleEnterBtn()">
                  <span class="text-sm text-gray-300 font-black uppercase">I accept these technical requirements.</span>
              </label>
              <button id="btnEnter" disabled onclick="closeModal('disclaimerModal')" class="mt-4 w-full py-4 bg-gray-700 text-gray-500 font-extrabold rounded-xl transition-all">Enter Factory</button>
          </div>
      </div>
  </div>

  <div class="max-w-6xl mx-auto blur-sm transition-all duration-500" id="mainContent">
    <header class="text-center mb-10">
      <h1 class="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400 mb-2 uppercase">OTG Factory</h1>
      <p class="text-white font-extrabold tracking-widest text-sm uppercase">Lone Worker AppSuite Compiler</p>
    </header>

    <div class="bg-gray-800 rounded-3xl shadow-2xl border border-gray-700 overflow-hidden">
      <div class="flex bg-gray-900 border-b border-gray-700 text-sm">
        <button onclick="gotoStep(1)" id="tab1" class="tab-btn active">1. Config</button>
        <button onclick="gotoStep(2)" id="tab2" class="tab-btn">2. Database</button>
        <button onclick="gotoStep(3)" id="tab3" class="tab-btn">3. Build & Download</button>
      </div>

      <div class="p-6 md:p-10">
        <div id="step1" class="step-section active">
          <div class="grid lg:grid-cols-2 gap-12 items-start">
            
            <div class="space-y-6">
              <div>
                  <label class="block text-blue-300 font-black mb-1 text-xs uppercase">Organisation Name</label>
                  <input type="text" id="orgName" class="input-field" value="My Organisation" oninput="saveInput(this)">
              </div>
              <div class="p-4 bg-gray-900 rounded-2xl border border-gray-700">
                  <h3 class="text-white font-black mb-4 uppercase text-[10px] tracking-widest">üîê Security Keys</h3>
                  <div class="mb-4">
                      <label class="block text-blue-300 font-bold mb-1 text-xs uppercase">Secret Admin Key</label>
                      <input type="text" id="secretKey" class="input-field py-2 text-yellow-400" oninput="saveInput(this)">
                  </div>
              </div>
            </div>

            <div id="paletteArea" class="space-y-6 bg-gray-900/50 p-6 rounded-3xl border border-gray-700">
                <h3 class="text-white font-black mb-4 uppercase text-[10px] tracking-widest text-center">üì± Live App Preview</h3>
                
                <div id="appMockup" class="mx-auto w-64 h-[400px] rounded-[2.5rem] border-[6px] border-gray-900 bg-[#111827] shadow-2xl overflow-hidden relative">
                    <div id="mockHeader" class="h-10 border-b border-gray-700 flex items-center px-4 bg-[#111827]">
                        <span id="mockOrgName" class="text-[10px] font-bold text-white truncate">Organisation</span>
                    </div>
                    <div class="p-4 space-y-4">
                        <div id="mockTravelCard" class="h-8 rounded-lg border border-gray-700"></div>
                        <div id="mockAccentCard" class="h-20 border-2 rounded-lg p-2"></div>
                    </div>
                    <div id="mockFooter" class="absolute bottom-0 w-full p-4 border-t border-gray-700 bg-[#111827]">
                        <div id="mockMainBtn" class="h-10 w-full rounded-xl flex items-center justify-center font-black text-[10px] text-white uppercase shadow-lg">Start Visit</div>
                    </div>
                </div>

                <div class="flex gap-4 justify-center mt-6">
                    <div class="preset-swatch" onclick="applyPreset('#1e40af', '#3b82f6', this)"><div class="swatch-half bg-[#1e40af]"></div><div class="swatch-half bg-[#3b82f6]"></div></div>
                    <div class="preset-swatch" onclick="applyPreset('#064e3b', '#10b981', this)"><div class="swatch-half bg-[#064e3b]"></div><div class="swatch-half bg-[#10b981]"></div></div>
                    <div class="preset-swatch" onclick="applyPreset('#450a0a', '#ef4444', this)"><div class="swatch-half bg-[#450a0a]"></div><div class="swatch-half bg-[#ef4444]"></div></div>
                </div>
            </div> </div> <div class="highlight-box border-blue-500/30 mt-8">
            <h3 class="text-xl font-black text-white uppercase mb-4">üõ°Ô∏è Safety & Fleet Options</h3>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <label class="block text-white font-black text-xs uppercase mb-2">Alarm Grace Period (Mins)</label>
                    <input type="number" id="escalationMins" value="15" class="input-field w-24 text-center" oninput="saveInput(this)">
                </div>
                <div class="flex items-center gap-3">
                    <input type="checkbox" id="chkVehicle" onchange="saveInput(this)" checked class="w-6 h-6">
                    <span class="text-sm font-black text-gray-200 uppercase">Daily Vehicle Check</span>
                </div>
            </div>
          </div>

          <div class="flex justify-end pt-12">
            <button onclick="gotoStep(2)" class="btn btn-primary text-lg px-12 shadow-2xl font-black uppercase">Next: Database Setup ‚Üí</button>
          </div>
        </div> <div id="step2" class="step-section">
            <div class="highlight-box border-green-500/30 text-center py-10">
                <h2 class="text-3xl font-black text-white mb-6 uppercase">Database Setup</h2>
                <a href="https://docs.google.com/spreadsheets/d/1vN43E8mFwQe_Mv_6h1v0C_3pX0Y6p7lE8x_v_e6r5C4/copy" target="_blank" class="btn bg-green-600 text-white font-black py-6 px-12 text-xl shadow-2xl uppercase">‚ú® Create Database Copy</a>
            </div>
            <div class="flex justify-between pt-12">
                <button onclick="gotoStep(1)" class="text-white font-black uppercase text-xs">Back</button>
                <button onclick="gotoStep(3)" class="btn btn-primary font-black uppercase">Next: Build ‚Üí</button>
            </div>
        </div>

        <div id="step3" class="step-section text-center">
            <div class="highlight-box">
                <h2 class="text-3xl font-black text-white mb-4 uppercase">Ready to Build</h2>
                <button onclick="buildZip()" class="btn btn-primary text-xl px-16 py-6 shadow-2xl font-black uppercase">üöÄ Download Zip Bundle</button>
            </div>
        </div>

      </div>
    </div>
  </div>

<script>
    // 1. MODAL LOGIC
    function toggleEnterBtn() {
        const chk = document.getElementById('chkAccept');
        const btn = document.getElementById('btnEnter');
        if (chk && btn) {
            btn.disabled = !chk.checked;
            if (chk.checked) {
                btn.classList.remove('bg-gray-700', 'text-gray-500');
                btn.classList.add('bg-blue-600', 'text-white');
            } else {
                btn.classList.add('bg-gray-700', 'text-gray-500');
                btn.classList.remove('bg-blue-600', 'text-white');
            }
        }
    }

    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
        document.getElementById('mainContent').classList.remove('blur-sm');
    }

    // 2. NAVIGATION
    function gotoStep(step) {
        document.querySelectorAll('.step-section').forEach(s => s.classList.remove('active'));
        document.getElementById('step' + step).classList.add('active');
        document.querySelectorAll('.tab-btn').forEach((b, i) => b.classList.toggle('active', i + 1 === step));
        window.scrollTo(0, 0);
    }

    // 3. BRANDING SYNC
    function applyPreset(p, a, el) {
        localStorage.setItem('otg_theme_primary', p); 
        localStorage.setItem('otg_theme_accent', a);
        
        const h = document.getElementById('mockHeader');
        const f = document.getElementById('mockFooter');
        const b = document.getElementById('mockMainBtn');
        const card = document.getElementById('mockAccentCard');

        if(h) h.style.backgroundColor = p;
        if(f) f.style.backgroundColor = p;
        if(b) b.style.backgroundColor = a; // Fixed: Use 'a', not 'accent'
        if(card) {
            card.style.borderColor = a;
            card.style.backgroundColor = a + '33';
        }

        document.querySelectorAll('.preset-swatch').forEach(s => s.classList.remove('selected'));
        if(el) el.classList.add('selected');
    }

    function saveInput(el) {
        localStorage.setItem('otg_' + el.id, el.type === 'checkbox' ? el.checked : el.value);
        if(el.id === 'orgName') document.getElementById('mockOrgName').innerText = el.value;
    }

    function buildZip() { alert('Building Zip Bundle...'); }

    window.onload = () => {
        const org = localStorage.getItem('otg_orgName');
        if(org) {
            document.getElementById('orgName').value = org;
            document.getElementById('mockOrgName').innerText = org;
        }
    };
</script>
  
// 1. NAVIGATION & INITIALIZATION
function gotoStep(step) {
    document.querySelectorAll('.step-section').forEach(s => s.classList.remove('active'));
    document.getElementById('step' + step).classList.add('active');
    document.querySelectorAll('.nav-btn').forEach((b, i) => {
        b.classList.toggle('active', i + 1 === step);
        b.classList.toggle('bg-blue-600', i + 1 === step);
        b.classList.toggle('text-white', i + 1 === step);
    });
    window.scrollTo(0, 0);
}

// 2. INTERACTIVE MOCKUP LOGIC
function updateMockupUI() {
    const org = document.getElementById('orgName').value;
    const logo = document.getElementById('logoUrl').value;
    const primary = localStorage.getItem('otg_theme_primary') || "#1e40af";
    const accent = localStorage.getItem('otg_theme_accent') || "#3b82f6";

    // Update Text & Logo
    document.getElementById('mockOrgName').innerText = org || "My Organisation";
    const mLogo = document.getElementById('mockLogo');
    if(logo && mLogo) {
        mLogo.src = logo;
        mLogo.classList.remove('hidden');
    }

    // Update Themed Components
    const header = document.getElementById('mockHeader');
    const footer = document.getElementById('mockFooter');
    const mainBtn = document.getElementById('mockMainBtn');
    const accentCard = document.getElementById('mockAccentCard');
    const travelCard = document.getElementById('mockTravelCard');

    if(header) header.style.backgroundColor = primary;
    if(footer) footer.style.backgroundColor = primary;
    if(mainBtn) mainBtn.style.backgroundColor = accent;
    
    if(accentCard) {
        accentCard.style.borderColor = accent;
        accentCard.style.backgroundColor = accent + '33'; // 20% opacity
    }
    if(travelCard) {
        travelCard.style.borderColor = accent + '4d'; // 30% opacity
        travelCard.style.backgroundColor = accent + '1a'; // 10% opacity
    }
}

function saveInput(el) { 
    localStorage.setItem('otg_' + el.id, el.type === 'checkbox' ? el.checked : el.value);
    if(['orgName', 'logoUrl', 'primaryColor', 'accentColor'].includes(el.id)) {
        if(el.id === 'primaryColor') document.getElementById('primaryColorBox').style.backgroundColor = el.value;
        if(el.id === 'accentColor') document.getElementById('accentColorBox').style.backgroundColor = el.value;
        updateMockupUI();
    }
}

// FIXING THE TYPEERROR
    function applyPreset(p, a, el) {
        // Update boxes
        const pBox = document.getElementById('primaryColorBox');
        const aBox = document.getElementById('accentColorBox');
        if(pBox) pBox.style.backgroundColor = p;
        if(aBox) aBox.style.backgroundColor = a;

        localStorage.setItem('otg_theme_primary', p); 
        localStorage.setItem('otg_theme_accent', a);
        
        // Safely Update Mockup
        const mockup = document.getElementById('appMockup');
        if(mockup) {
            mockup.style.backgroundColor = p;
            const h = document.getElementById('mockHeader');
            const f = document.getElementById('mockFooter');
            const b = document.getElementById('mockMainBtn');
            if(h) h.style.backgroundColor = p;
            if(f) f.style.backgroundColor = p;
            if(b) b.style.backgroundColor = a; // CORRECTED: Use 'a', not 'accent'
        }
        
        const card = document.getElementById('mockAccentCard');
        if(card) {
            card.style.borderColor = a;
            card.style.backgroundColor = a + '33';
        }

        document.querySelectorAll('.preset-swatch').forEach(s => s.classList.remove('selected'));
        if(el) el.classList.add('selected');
    }
// 3. ZIP BUILD ENGINE
async function buildZip() {
    const status = document.getElementById('buildStatus');
    status.innerText = "Compiling resources...";
    
    const zip = new JSZip();
    // Logic for building the ZIP bundle goes here...
    
    status.innerText = "Done! Download started.";
    document.getElementById('launchPack').classList.remove('hidden');
}

// Load saved data on boot
window.onload = () => {
    ['orgName', 'logoUrl', 'scriptUrl', 'secretKey', 'alarmGrace', 'mapsKey'].forEach(id => {
        const val = localStorage.getItem('otg_' + id);
        if(val) document.getElementById(id).value = val;
    });
    const vehicle = localStorage.getItem('otg_vehicleCheck');
    if(vehicle) document.getElementById('vehicleCheck').checked = (vehicle === 'true');
    updateMockupUI();
};
</script>
</body>
</html>


